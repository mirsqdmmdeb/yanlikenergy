<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Yanlik • Sohbet</title>
<link rel="stylesheet" href="yanlik.css">
<style>
  main{height:calc(100vh - 112px);overflow:auto;padding:16px}
  .topbar{position:fixed;top:10px;right:10px;z-index:2;background:rgba(0,0,0,.45);
    border:1px solid #ffffff22;backdrop-filter:blur(10px);padding:8px;border-radius:12px;display:flex;gap:8px;align-items:center}
  .topbar select{padding:6px 8px}
</style>
</head>
<body>
<canvas id="bg"></canvas>

<div class="topbar">
  <span style="color:#9fd3ff;font-size:.9rem">Animasyon</span>
  <select id="animPick" class="input" style="width:160px;padding:6px 8px">
    <option value="neon">Neon Ağ (Eski)</option>
    <option value="stars">Yıldız Alanı</option>
    <option value="wave">Dalga Alanı</option>
    <option value="matrix">Matrix Yağmuru</option>
    <option value="orbs">Gezinen Küreler</option>
    <option value="gridflow">Grid Akışı</option>
    <option value="triangulate">Üçgen Ağ</option>
  </select>
  <span style="color:#9fd3ff;font-size:.9rem;margin-left:6px">Tema</span>
  <select id="themePick" class="input" style="width:150px;padding:6px 8px">
    <option value="mavi">mavi</option>
    <option value="altın">altın</option>
    <option value="mor">mor</option>
    <option value="yeşil">yeşil</option>
    <option value="pembe">pembe</option>
    <option value="neon-mavi">neon-mavi</option>
    <option value="neon-mor">neon-mor</option>
  </select>
  <button id="clearBtn" class="btn" title="Sohbeti temizle">Temizle</button>
</div>

<main id="scroll">
  <div id="area" class="page" style="max-width:980px"></div>
  <div id="typing" class="page" style="max-width:980px;display:none">
    <span class="typing"><i></i><i></i><i></i></span> Yanlik yazıyor…
  </div>
</main>

<footer class="chat">
  <div class="chatbar">
    <input id="msg" class="input" placeholder='Mesaj yaz… (örn: "= 2+3*5", "/theme altın", "/anim matrix", "plan")' autocomplete="off">
    <button id="send" class="btn neon">Gönder</button>
  </div>
  <div class="links">
    <a href="index.html">Ana sayfa</a>
    <a href="ayarlar.html">Ayarlar</a>
  </div>
</footer>

<script src="bg.js"></script>
<script>
/* ---------- Kalıcı tema & anim ---------- */
function applyThemeClass(name){
  document.documentElement.classList.remove(
    'theme-altin','theme-mor','theme-yesil','theme-pembe','theme-neon-mavi','theme-neon-mor'
  );
  switch(name){
    case 'altın': document.documentElement.classList.add('theme-altin'); break;
    case 'mor': document.documentElement.classList.add('theme-mor'); break;
    case 'yeşil': document.documentElement.classList.add('theme-yesil'); break;
    case 'pembe': document.documentElement.classList.add('theme-pembe'); break;
    case 'neon-mavi': document.documentElement.classList.add('theme-neon-mavi'); break;
    case 'neon-mor': document.documentElement.classList.add('theme-neon-mor'); break;
    default: /* mavi */ document.documentElement.classList.remove('theme-altin','theme-mor','theme-yesil','theme-pembe','theme-neon-mavi','theme-neon-mor');
  }
}

const animSel = document.getElementById('animPick');
const themeSel = document.getElementById('themePick');
const savedAnim = localStorage.getItem('yanlik:anim') || 'neon';
const savedTheme = localStorage.getItem('yanlik:theme') || 'mavi';
animSel.value = savedAnim; themeSel.value = savedTheme;
applyThemeClass(savedTheme);
window.YANLIK_BG && YANLIK_BG.setAnimation(savedAnim);

animSel.onchange = () => {
  localStorage.setItem('yanlik:anim', animSel.value);
  window.YANLIK_BG && YANLIK_BG.setAnimation(animSel.value);
};
themeSel.onchange = () => {
  localStorage.setItem('yanlik:theme', themeSel.value);
  applyThemeClass(themeSel.value);
};

/* ---------- Ses: kısa “blip” ---------- */
let audioCtx;
function blip(){
  try{
    audioCtx = audioCtx || new (window.AudioContext||window.webkitAudioContext)();
    const o = audioCtx.createOscillator();
    const g = audioCtx.createGain();
    o.type='sine'; o.frequency.value=880;
    g.gain.setValueAtTime(0.07,audioCtx.currentTime);
    g.gain.exponentialRampToValueAtTime(0.00001,audioCtx.currentTime+0.08);
    o.connect(g); g.connect(audioCtx.destination); o.start(); o.stop(audioCtx.currentTime+0.09);
  }catch(e){}
}

/* ---------- Mesaj akışı + kalıcı geçmiş ---------- */
const KEY='yanlik:chatlog';
const area=document.getElementById('area'), typing=document.getElementById('typing'), box=document.getElementById('scroll');
const msg=document.getElementById('msg'), send=document.getElementById('send'), clearBtn=document.getElementById('clearBtn');

function now(){return new Date().toLocaleTimeString('tr-TR',{hour:'2-digit',minute:'2-digit'})}
function push(role, html, save=true){
  const d=document.createElement('div');
  d.className='msg '+(role==='me'?'me':'bot');
  d.innerHTML=`<div class="meta">${now()} • ${role==='me'?'Ben':'Yanlik'}</div>${html}`;
  area.appendChild(d); box.scrollTop=box.scrollHeight;
  if(save){ const log = JSON.parse(localStorage.getItem(KEY)||'[]'); log.push({role,html,time:Date.now()}); localStorage.setItem(KEY, JSON.stringify(log)); }
}
function loadHistory(){
  const log = JSON.parse(localStorage.getItem(KEY)||'[]');
  for(const it of log){ push(it.role,it.html,false); }
}
function clearHistory(){ localStorage.removeItem(KEY); area.innerHTML=''; push('bot','Temizlendi ✅'); }

loadHistory();
if(!JSON.parse(localStorage.getItem(KEY)||'[]').length){
  push('bot','Selam! Ben <b>Yanlik</b>. Komutlar: <code>= 2+3*5</code>, <code>plan</code>, <code>çevir: merhaba dünya</code>, <code>/theme altın</code>, <code>/anim matrix</code>.');
}

function setThemeByName(name){
  localStorage.setItem('yanlik:theme', name);
  applyThemeClass(name);
}
function setAnimByName(name){
  localStorage.setItem('yanlik:anim', name);
  window.YANLIK_BG && YANLIK_BG.setAnimation(name);
}

async function handleSend(){
  const t=msg.value.trim(); if(!t) return;
  push('me', t); blip(); msg.value=''; typing.style.display='block';

  const replies = YanlikAI.respond(t,{
    onTheme: setThemeByName,
    onAnim:  setAnimByName
  });
  await new Promise(r=>setTimeout(r, 350));
  typing.style.display='none';
  replies.forEach(r=>push('bot', r.text));
}
send.onclick=handleSend;
msg.addEventListener('keydown',e=>{ if(e.key==='Enter'&&!e.shiftKey){ e.preventDefault(); handleSend(); }});
clearBtn.onclick=clearHistory;

/* ---------- Basit kural tabanlı “motor” ---------- */
const YanlikAI = (()=>{
  function pick(a){return a[Math.floor(Math.random()*a.length)]}
  function esc(s){return (s||"").replace(/[<>&]/g,m=>({'<':'&lt;','>':'&gt;','&':'&amp;'}[m]))}
  function detect(t){
    const x=t.toLowerCase().trim();
    if(x.startsWith('/theme ')) return {k:'theme',v:x.slice(7).trim()};
    if(x.startsWith('/anim '))  return {k:'anim',v:x.slice(6).trim()};
    if(x.startsWith('=') || /(^|\s)hesapla(\s|:)/.test(x)) return {k:'calc',v:x.replace(/^=/,'').replace(/(^|\s)hesapla(\s|:)?/,' ').trim()};
    if(/(plan|madde madde|listele)/.test(x)) return {k:'plan',v:t};
    if(/(çevir:|translate:)/.test(x)) return {k:'tr',v:t.replace(/(çevir:|translate:)/i,'').trim()};
    if(/(özetle|kısalt|shorten)/.test(x)) return {k:'sum',v:t};
    if(/(merhaba|selam|hey)/.test(x)) return {k:'hi'};
    return {k:'chat'};
  }
  function calc(expr){ try{return 'Sonuç: <b>'+esc(String(Function('return ('+expr+')')()))+'</b>'}catch{ return 'İşlem hatalı görünüyor 🤔'} }
  function bullets(s){ const parts=s.split(/[.,;•\-–—]\s+/).filter(Boolean).slice(0,6); return (parts.length?parts:['Hedefi netleştir','Adımları sırala','Zaman planı yap']).map(p=>'• '+esc(p)).join('<br>'); }
  function trAuto(s){ const d={'merhaba':'hello','nasılsın':'how are you','teşekkürler':'thanks','evet':'yes','hayır':'no'}; if(/[ığüşöç]/i.test(s)){return s.split(/\s+/).map(w=>d[w.toLowerCase()]||w).join(' ');} const r=Object.fromEntries(Object.entries(d).map(([a,b])=>[b,a]));return s.split(/\s+/).map(w=>r[w.toLowerCase()]||w).join(' ');}
  function respond(t,hooks={}){
    const it=detect(t), out=[];
    switch(it.k){
      case 'hi': out.push({text:'Selam! Ben <b>Yanlik</b>. Hazırım 😎'}); break;
      case 'calc': out.push({text:calc(it.v)}); break;
      case 'plan': out.push({text:'Tamam, planı maddeliyorum:'}); out.push({text:bullets(it.v)}); break;
      case 'tr': out.push({text:'Çeviri: <i>'+esc(trAuto(it.v))+'</i>'}); break;
      case 'sum': { const s=t.split(/[.!?]/).map(x=>x.trim()).filter(Boolean).slice(0,2).join('. ')+'.'; out.push({text:'Kısa özet: '+esc(s)}); } break;
      case 'theme': hooks.onTheme && hooks.onTheme(it.v); out.push({text:`Tema değiştirildi: <b>${esc(it.v)}</b>`}); break;
      case 'anim': hooks.onAnim && hooks.onAnim(it.v); out.push({text:`Animasyon değiştirildi: <b>${esc(it.v)}</b>`}); break;
      default: out.push({text:pick(['Dinliyorum 👂','Devam et 🔍','Biraz daha detay verir misin?','Bunu çözelim 💡'])});
    }
    return out;
  }
  return {respond};
})();
</script>
</body>
</html>