<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>Yanlik â€¢ Sohbet</title>
<link rel="stylesheet" href="yanlik.css">
<style>
  main{height:calc(100vh - 104px);overflow:auto;padding:16px}
  .topbar{position:fixed;top:10px;right:10px;z-index:2;background:rgba(0,0,0,.45);
    border:1px solid #ffffff22;backdrop-filter:blur(10px);padding:8px;border-radius:12px;display:flex;gap:8px;align-items:center}
  .topbar select{padding:6px 8px}
</style>
</head>
<body>
<canvas id="bg"></canvas>

<div class="topbar">
  <span style="color:#9fd3ff;font-size:.9rem">Animasyon</span>
  <select id="animPick" class="input" style="width:170px;padding:6px 8px">
    <option value="neon">Neon AÄŸ (Eski)</option>
    <option value="stars">YÄ±ldÄ±z AlanÄ±</option>
    <option value="wave">Dalga AlanÄ±</option>
    <option value="matrix">Matrix YaÄŸmuru</option>
    <option value="orbs">Gezinen KÃ¼reler</option>
    <option value="gridflow">Grid AkÄ±ÅŸÄ±</option>
    <option value="triangulate">ÃœÃ§gen AÄŸ</option>
  </select>
</div>

<main id="scroll">
  <div id="area" class="page" style="max-width:980px"></div>
  <div id="typing" class="page" style="max-width:980px;display:none;color:#9bb3cc">Yanlik yazÄ±yorâ€¦ â€¢ â€¢ â€¢</div>
</main>

<footer class="chat">
  <div class="chatbar">
    <input id="msg" class="input" placeholder='Mesaj yazâ€¦ (Ã¶rn: "= 2+3*5", "/theme altÄ±n", "/anim matrix", "plan")' autocomplete="off">
    <button id="send" class="btn neon">GÃ¶nder</button>
  </div>
  <div class="links">
    <a href="index.html">Ana sayfa</a>
    <a href="ayarlar.html">Ayarlar</a>
  </div>
</footer>

<script src="bg.js"></script>
<script>
// ----- basit auth guard (opsiyonel) -----
// if(!localStorage.getItem('yanlik:session')) location.replace('login.html');

// ----- UI helpers -----
const area = document.getElementById('area');
const typing = document.getElementById('typing');
const scrollBox = document.getElementById('scroll');
function now(){return new Date().toLocaleTimeString('tr-TR',{hour:'2-digit',minute:'2-digit'})}
function push(role, html){
  const d=document.createElement('div');
  d.className='msg '+(role==='me'?'me':'bot');
  d.innerHTML = `<div class="meta">${now()} â€¢ ${role==='me'?'Ben':'Yanlik'}</div>${html}`;
  area.appendChild(d);
  scrollBox.scrollTop = scrollBox.scrollHeight;
}

// ----- animasyon seÃ§ici -----
const animSel = document.getElementById('animPick');
const savedAnim = localStorage.getItem('yanlik:anim') || 'neon';
animSel.value = savedAnim;
window.YANLIK_BG && YANLIK_BG.setAnimation(savedAnim);
animSel.onchange = () => {
  localStorage.setItem('yanlik:anim', animSel.value);
  window.YANLIK_BG && YANLIK_BG.setAnimation(animSel.value);
};

// ----- KonuÅŸma Motoru (geliÅŸtirilmiÅŸ rule-based) -----
const YanlikAI = (()=>{

  const moods = ['neÅŸeli','sakin','fokus','meraklÄ±','motive','dÃ¼ÅŸÃ¼nceli'];
  const starters = [
    'Dinliyorum ğŸ‘‚', 'Devam et ğŸ”', 'Detay verebilir misin?', 'Bunu birlikte Ã§Ã¶zelim ğŸ’¡',
    'Ä°lginÃ§, biraz daha aÃ§ar mÄ±sÄ±n?', 'Pekala, madde madde ilerleyelim.'
  ];

  function pick(a){ return a[Math.floor(Math.random()*a.length)] }
  function esc(s){ return (s||"").replace(/[<>&]/g,m=>({'<':'&lt;','>':'&gt;','&':'&amp;'}[m])) }

  function detectIntent(t){
    const x=t.toLowerCase().trim();
    if(x.startsWith('/theme ')) return {k:'theme',v:x.slice(7).trim()};
    if(x.startsWith('/anim '))  return {k:'anim',v:x.slice(6).trim()};
    if(x.startsWith('=') || /(^|\s)hesapla(\s|:)/.test(x)) return {k:'calc',v:x.replace(/^=/,'').replace(/(^|\s)hesapla(\s|:)?/,' ').trim()};
    if(/(plan|madde madde|listele)/.test(x)) return {k:'plan'};
    if(/(Ã§evir:|translate:)/.test(x)) return {k:'translate',v:x.replace(/(Ã§evir:|translate:)/i,'').trim()};
    if(/(Ã¶zetle|kÄ±salt|shorten)/.test(x)) return {k:'summ'};
    if(/(merhaba|selam|hey)/.test(x)) return {k:'greet'};
    if(/(Ã¼zgÃ¼n|moral|kÃ¶tÃ¼ hissediyorum)/.test(x)) return {k:'support'};
    return {k:'chat'};
  }

  function calc(expr){
    try{ const out = Function('return ('+expr+')')(); return 'SonuÃ§: <b>'+esc(String(out))+'</b>'; }
    catch{ return 'Ä°ÅŸlem hatalÄ± gÃ¶rÃ¼nÃ¼yor ğŸ¤”'; }
  }

  function translateAuto(s){
    // mini sÃ¶zlÃ¼k + Ã§ok basit kural (demo)
    const dict = { 'merhaba':'hello', 'nasÄ±lsÄ±n':'how are you', 'teÅŸekkÃ¼rler':'thanks', 'evet':'yes', 'hayÄ±r':'no' };
    // TRâ†’EN
    if(/[Ä±ÄŸÃ¼ÅŸÃ¶Ã§]/i.test(s)) {
      return s.split(/\s+/).map(w=>dict[w.toLowerCase()]||w).join(' ');
    }
    // ENâ†’TR
    const rev = Object.fromEntries(Object.entries(dict).map(([tr,en])=>[en,tr]));
    return s.split(/\s+/).map(w=>rev[w.toLowerCase()]||w).join(' ');
  }

  function bullets(text){
    const parts = text.split(/[.,;â€¢\-â€“â€”]\s+/).filter(Boolean).slice(0,6);
    if(!parts.length) return 'â€¢ Hedefi netleÅŸtir<br>â€¢ AdÄ±mlarÄ± sÄ±rala<br>â€¢ Zaman tahminleri ekle';
    return parts.map(p=>'â€¢ '+esc(p)).join('<br>');
  }

  function respond(input, hooks={}){
    const it = detectIntent(input);
    const out = [];

    switch(it.k){
      case 'greet':
        out.push({text:`Selam! Ben <b>Yanlik</b>. BugÃ¼n ${pick(moods)} moddayÄ±m ğŸ˜`});
        break;

      case 'support':
        out.push({text:`Zor bir gÃ¼n gibiâ€¦ Birlikte nefes alalÄ±m: 4 sn al â 4 sn tut â 6 sn ver. Ä°stersen konuÅŸuruz ğŸŒ™`});
        break;

      case 'calc':
        out.push({text: calc(it.v) });
        break;

      case 'plan':
        out.push({text:'Tamam, madde madde yazÄ±yorum:'});
        out.push({text: bullets(input) });
        break;

      case 'translate':
        out.push({text:'Ã‡eviri: <i>'+esc(translateAuto(it.v))+'</i>'});
        break;

      case 'summ':
        // demo: cÃ¼mle kÄ±saltma
        const short = input.split(/[.!?]/).map(s=>s.trim()).filter(Boolean).slice(0,2).join('. ') + '.';
        out.push({text:'KÄ±sa Ã¶zet: '+esc(short)});
        break;

      case 'theme':
        hooks.onTheme && hooks.onTheme(it.v);
        out.push({text:`Tema deÄŸiÅŸtirildi: <b>${esc(it.v)}</b>`});
        break;

      case 'anim':
        hooks.onAnim && hooks.onAnim(it.v);
        out.push({text:`Animasyon deÄŸiÅŸtirildi: <b>${esc(it.v)}</b>`});
        break;

      default:
        out.push({text: pick(starters) });
    }

    return out;
  }

  return {respond};
})();

// ----- mesaj akÄ±ÅŸÄ± -----
const msg = document.getElementById('msg');
const send = document.getElementById('send');

function setTheme(name){
  // Ã¶rnek: sadece altÄ±n temayÄ± gÃ¶steriyoruz; istersen geniÅŸletirsin
  if(name==='altÄ±n'){
    document.documentElement.style.setProperty('--c1','#ffd166');
    document.documentElement.style.setProperty('--c2','#ffcc66');
  } else {
    document.documentElement.style.setProperty('--c1','#00c9ff');
    document.documentElement.style.setProperty('--c2','#0077ff');
  }
}
function setAnim(name){
  localStorage.setItem('yanlik:anim', name);
  window.YANLIK_BG && YANLIK_BG.setAnimation(name);
}

async function handleSend(){
  const t = msg.value.trim(); if(!t) return;
  push('me', t);
  msg.value=''; typing.style.display='block';

  const replies = YanlikAI.respond(t, {onTheme:setTheme, onAnim:setAnim});
  await new Promise(r=>setTimeout(r, 350));
  typing.style.display='none';
  replies.forEach(r=>push('bot', r.text));
}
send.onclick = handleSend;
msg.addEventListener('keydown', e=>{
  if(e.key==='Enter' && !e.shiftKey){ e.preventDefault(); handleSend(); }
});

// aÃ§Ä±lÄ±ÅŸ mesajÄ±
push('bot','Selam! Ben <b>Yanlik</b>. Ã–rnek komutlar: <code>= 2+3*5</code>, <code>plan</code>, <code>Ã§evir: merhaba dÃ¼nya</code>, <code>/theme altÄ±n</code>, <code>/anim matrix</code>.');

</script>
</body>
</html>